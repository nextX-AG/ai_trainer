{% extends "base.html" %}

{% block content %}
<div class="page-section">
    <div class="flex justify-between items-center mb-6">
        <h2 class="section-title">Projekte</h2>
        <button id="new-project-btn" class="btn-primary">Neues Projekt</button>
    </div>

    <!-- Projekt Liste -->
    <div id="projects-list" class="grid gap-4">
        {% for project in projects %}
        <div class="project-card">
            <div class="flex justify-between items-start">
                <div>
                    <h3 class="text-lg font-semibold">{{ project.name }}</h3>
                    <p class="text-gray-600">{{ project.description }}</p>
                    <div class="mt-2">
                        <span class="badge badge-{{ project.source_type }}">{{ project.source_type }}</span>
                        <span class="badge badge-{{ project.data_source }}">{{ project.data_source }}</span>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button class="btn-secondary edit-project" data-id="{{ project.id }}">Bearbeiten</button>
                    <button class="btn-danger delete-project" data-id="{{ project.id }}">Löschen</button>
                </div>
            </div>
            <div class="mt-4 text-sm text-gray-500">
                Erstellt von: {{ project.owner }} | Status: {{ project.status }}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Neues Projekt Modal -->
    <div id="project-modal" class="modal hidden">
        <div class="modal-content">
            <h3 class="modal-title">Neues Projekt</h3>
            <form id="project-form">
                <div class="form-group">
                    <label for="project-name">Name</label>
                    <input type="text" id="project-name" required>
                </div>
                <div class="form-group">
                    <label for="project-description">Beschreibung</label>
                    <textarea id="project-description"></textarea>
                </div>
                <div class="form-group">
                    <label for="source-type">Quelltyp</label>
                    <select id="source-type" required>
                        <option value="video">Video</option>
                        <option value="image">Bild</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="data-source">Datenquelle</label>
                    <select id="data-source" required>
                        <option value="url">Direkte URLs</option>
                        <option value="porndb">PornDB API</option>
                        <option value="search">Suche</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" class="btn-secondary" onclick="closeModal()">Abbrechen</button>
                    <button type="submit" class="btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: flex;
    justify-content: center;
    align-items: center;
}

.modal-content {
    background: white;
    padding: 2rem;
    border-radius: 0.5rem;
    width: 100%;
    max-width: 500px;
}

.badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 500;
    margin-right: 0.5rem;
}

.badge-video { background: #e0f2fe; color: #0369a1; }
.badge-image { background: #f0fdf4; color: #166534; }
.badge-url { background: #fef3c7; color: #92400e; }
.badge-porndb { background: #ede9fe; color: #5b21b6; }
.badge-search { background: #fce7f3; color: #9d174d; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('project-modal');
    const newProjectBtn = document.getElementById('new-project-btn');
    const projectForm = document.getElementById('project-form');
    
    // Modal öffnen
    newProjectBtn.addEventListener('click', () => {
        modal.classList.remove('hidden');
    });

    // Projekt erstellen
    projectForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = {
            name: document.getElementById('project-name').value,
            description: document.getElementById('project-description').value,
            source_type: document.getElementById('source-type').value,
            data_source: document.getElementById('data-source').value,
            owner: 'dev' // TODO: Dynamisch vom eingeloggten User
        };
        
        try {
            const response = await fetch('/api/projects/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });
            
            if (response.ok) {
                window.location.reload();
            } else {
                const error = await response.json();
                alert('Fehler: ' + error.detail);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Ein Fehler ist aufgetreten');
        }
    });

    // Projekt löschen
    document.querySelectorAll('.delete-project').forEach(button => {
        button.addEventListener('click', async (e) => {
            if (confirm('Projekt wirklich löschen?')) {
                const id = e.target.dataset.id;
                try {
                    const response = await fetch(`/api/projects/${id}`, {
                        method: 'DELETE'
                    });
                    if (response.ok) {
                        window.location.reload();
                    }
                } catch (error) {
                    console.error('Error:', error);
                }
            }
        });
    });
});

function closeModal() {
    document.getElementById('project-modal').classList.add('hidden');
}
</script>
{% endblock %} 